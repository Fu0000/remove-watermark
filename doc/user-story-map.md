# 去水印项目用户故事地图（v1.0）

## 1. 文档信息

| 字段 | 内容 |
|---|---|
| 文档名称 | User Story Map |
| 版本 | v1.0 |
| 状态 | Ready for Planning |
| 对应PRD | `/Users/codelei/Documents/ai-project/remove-watermark/doc/prd.md` |
| 对应IA | `/Users/codelei/Documents/ai-project/remove-watermark/doc/ia.md` |
| 对应API | `/Users/codelei/Documents/ai-project/remove-watermark/doc/api-spec.md` |
| 更新时间 | 2026-02-19 |

## 2. 文档目标、范围、规则、示例、验收

### 2.1 目标
- 将 `FR-001~FR-012` 转换为用户可理解、研发可拆解、测试可验证的故事地图。
- 建立 `Now/Next/Later` 发布切片，直接服务 MVP 与后续迭代排期。
- 明确每个故事对 `MET-001~MET-005` 的贡献路径。

### 2.2 范围
- 主人群：电商运营、自媒体创作者、中小团队内容制作人员。
- MVP 范围：图片/视频、任务中心、结果下载、套餐订阅、数据管理。
- V1.1：PDF/PPT 图片页；V1.2：批量模板+团队能力。

### 2.3 规则
- 统一状态机：`UPLOADED -> QUEUED -> PREPROCESSING -> DETECTING -> INPAINTING -> PACKAGING -> SUCCEEDED|FAILED|CANCELED`。
- 统一术语：配额、权益、任务、素材、事件名与 API 文档一致。
- 每个故事必须包含：角色、触发条件、预期价值、验收条件。

### 2.4 示例
- 示例故事：
  - 作为订阅用户，我希望在任务失败后一键重试，这样我无需重新上传素材。

### 2.5 验收
- 所有 FR 均映射至少 1 条用户故事。
- 所有 MET 均映射至少 1 条关键活动或故事指标。
- 发布切片中的故事可直接转为迭代 backlog。

## 3. 用户活动骨架（Backbone）

1. 进入产品与登录
2. 上传素材
3. 编辑与检测
4. 创建与跟踪任务
5. 预览与下载结果
6. 套餐与订阅
7. 账户与数据治理
8. 风控与运营保障

## 4. 故事地图（活动泳道 -> 用户任务 -> 用户故事）

| 活动泳道 | 用户任务 | 用户故事 | 对应FR | 关键价值 | 对应MET |
|---|---|---|---|---|---|
| 进入产品与登录 | 微信授权登录 | 作为新用户，我希望 10 秒内完成登录并开始上传 | FR-001 | 降低首用门槛 | MET-002 |
| 进入产品与登录 | 会话续期 | 作为回访用户，我希望不会频繁掉线影响任务追踪 | FR-001 | 提升连续体验 | MET-001 |
| 上传素材 | 格式与大小校验 | 作为用户，我希望上传前知道是否可处理，避免无效等待 | FR-002 | 减少失败上传 | MET-002 |
| 上传素材 | 分片上传/断点续传 | 作为弱网用户，我希望上传中断后可恢复 | FR-002 | 提升成功率 | MET-003 |
| 编辑与检测 | 自动检测水印区域 | 作为普通用户，我希望系统自动框选水印，减少手工 | FR-003 | 降低操作成本 | MET-004 |
| 编辑与检测 | 手动蒙版修正 | 作为高质量诉求用户，我希望可手动修正误检漏检 | FR-004 | 提升效果稳定性 | MET-003 |
| 创建与跟踪任务 | 创建任务（标准/高质量） | 作为用户，我希望按场景选择处理质量与速度 | FR-005 | 平衡速度与效果 | MET-003 |
| 创建与跟踪任务 | 查看任务进度 | 作为用户，我希望随时看到任务进展与预计耗时 | FR-006 | 降低不确定感 | MET-004 |
| 创建与跟踪任务 | 失败重试/取消 | 作为用户，我希望失败后可重试，等待过久可取消 | FR-005, FR-006 | 提升可控性 | MET-003 |
| 预览与下载结果 | 前后对比预览 | 作为用户，我希望对比前后效果再决定下载 | FR-007 | 提升结果信任 | MET-001 |
| 预览与下载结果 | 结果下载与过期提醒 | 作为用户，我希望在链接过期前被提醒 | FR-007 | 避免结果丢失 | MET-001 |
| 套餐与订阅 | 查看套餐权益 | 作为用户，我希望清晰理解免费与付费差异 | FR-008 | 提升购买意愿 | MET-005 |
| 套餐与订阅 | 发起订阅支付 | 作为用户，我希望支付后权益即时生效 | FR-008 | 缩短转化路径 | MET-005 |
| 套餐与订阅 | 用量与配额可视化 | 作为用户，我希望知道剩余额度与消耗明细 | FR-008 | 降低付费焦虑 | MET-005 |
| 账户与数据治理 | 删除素材/任务 | 作为用户，我希望自主删除历史内容 | FR-010 | 提升隐私信任 | MET-001 |
| 账户与数据治理 | 账户删除申请 | 作为用户，我希望注销后数据按承诺清理 | FR-010 | 合规可信 | MET-001 |
| 风控与运营保障 | 异常行为拦截 | 作为平台，我希望识别滥用请求保护服务稳定 | FR-011 | 风险控制 | MET-003 |
| 风控与运营保障 | 后台任务检索与重放 | 作为运营，我希望快速定位并修复失败任务 | FR-012 | 降低故障恢复时间 | MET-003 |
| 风控与运营保障 | 套餐管理 | 作为运营，我希望可调整套餐策略并生效 | FR-012 | 支撑商业迭代 | MET-005 |

## 5. 优先级矩阵（价值/复杂度）

| 级别 | 定义 | 代表故事 |
|---|---|---|
| P0（高价值低复杂） | MVP 必做 | 登录、上传校验、任务创建、任务中心、下载 |
| P1（高价值中复杂） | MVP 增强 | 自动检测、手动蒙版、失败重试、配额展示 |
| P2（高价值高复杂） | Next | 高质量视频路径优化、订阅生命周期完善 |
| P3（中价值中复杂） | Later | PDF/PPT页图能力、批量模板、团队权限 |

## 6. 发布切片（Now/Next/Later）

| 切片 | 目标版本 | 用户可见能力 | 对应FR |
|---|---|---|---|
| Now | MVP(v1.0) | 图片/视频上传、自动检测、任务中心、结果下载、基础订阅与配额 | FR-001~FR-010（FR-011/012最小集） |
| Next | V1.1 | PDF/PPT 图片页处理、批量文档任务 | FR-002, FR-005, FR-006, FR-007 扩展 |
| Later | V1.2 | 批量模板、团队空间、企业能力 | FR-011, FR-012 扩展 |

## 7. FR 与故事追踪矩阵

| FR | 关键故事ID | 依赖页面（IA） | 依赖API | 验收方式 |
|---|---|---|---|---|
| FR-001 | US-LOGIN-01, US-SESSION-02 | P-001, P-009 | `/v1/auth/*` | E2E 登录/续期 |
| FR-002 | US-UPLOAD-01, US-UPLOAD-02 | P-002 | `/v1/assets/upload-policy` | 弱网/断点续传测试 |
| FR-003 | US-DETECT-01 | P-003 | `/v1/tasks`, 内部检测链路 | 自动检测命中率测试 |
| FR-004 | US-MASK-01 | P-003 | `/v1/tasks/{taskId}/mask` | 编辑交互回归 |
| FR-005 | US-TASK-01, US-TASK-RETRY | P-004, P-005 | `/v1/tasks*` | 状态机一致性测试 |
| FR-006 | US-JOBS-TRACK | P-004, P-005 | `/v1/tasks`, SSE | 刷新时延测试 |
| FR-007 | US-RESULT-01 | P-006 | `/v1/tasks/{taskId}/result` | 下载与过期测试 |
| FR-008 | US-PLAN-01, US-SUB-02 | P-007, P-008 | `/v1/plans`, `/v1/subscriptions/*`, `/v1/usage/me` | 订阅联调 |
| FR-009 | US-NOTI-01 | P-011 | `/v1/notifications*` | 通知可达性测试 |
| FR-010 | US-DELETE-01 | P-010 | 删除与注销接口 | 隐私合规演练 |
| FR-011 | US-RISK-01 | P-011 | 风控中间件+审计接口 | 滥用防护演练 |
| FR-012 | US-ADMIN-01 | A-002~A-005 | `/admin/*` | RBAC 与重放测试 |

## 8. MET 指标映射（活动级）

| 指标 | 定义 | 主影响活动 | 先导指标 |
|---|---|---|---|
| MET-001 | 7日留存率 | 登录、任务中心、结果复访 | 次日活跃、任务复查率 |
| MET-002 | 上传到创建转化率 | 上传、编辑、提交任务 | 上传成功率、编辑完成率 |
| MET-003 | 任务成功率 | 任务编排、重试、风控 | 失败重试成功率 |
| MET-004 | TTFR | 自动检测、队列调度、预处理 | 排队等待时长 |
| MET-005 | 订阅转化率 | 套餐展示、支付、配额提示 | 套餐页访问到下单转化率 |

## 9. 示例故事模板（用于 backlog）

```text
故事ID: US-TASK-RETRY-01
角色: 订阅用户
场景: 任务因模型异常失败
目标: 一键重试，且不重复扣减额度
验收条件:
1) 点击重试后状态转为 QUEUED
2) usage_ledger 不新增 COMMITTED 重复记录
3) 任务在 2 次重试内成功或标记 FAILED
```

## 10. 验收清单

1. `FR-001~FR-012` 全量映射并可追踪到页面/API。
2. `MET-001~MET-005` 全量映射并可追踪到关键活动。
3. `Now/Next/Later` 切片与 PRD 版本边界一致。
4. 所有高优故事具备明确验收条件，可直接创建研发任务。
5. 术语、状态机、接口路径与基线文档一致。

## 11. 版本记录

| 版本 | 日期 | 说明 |
|---|---|---|
| v1.0 | 2026-02-19 | 首版用户故事地图，覆盖FR/MET映射、优先级矩阵、发布切片 |
