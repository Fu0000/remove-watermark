# 前后端联调流程规范（v1.0）

## 1. 目标
- 建立可执行联调流程，减少环境与契约偏差。
- 保证从 Mock 到 Staging 的链路连续可验证。

## 2. 范围
- 适用于小程序/Web 前台、管理后台、Node 后端服务。
- 环境模型：`dev/shared/staging/prod`。

## 3. 规则

### 3.1 联调阶段
1. 契约冻结：OpenAPI 字段、错误码、状态机字面量冻结。
2. Mock 联调：前端先跑页面流程与异常处理。
3. shared 联调：连接真实后端和共享数据。
4. staging 验收：执行回归与性能 smoke。

### 3.2 协议标准
| 项 | 规则 |
|---|---|
| Authorization | Bearer Token，过期统一走刷新流程 |
| Idempotency-Key | 创建任务必填，前端生成并复用 |
| X-Request-Id | 每次请求生成，便于排障 |
| 错误码 | 仅以后端错误码语义为准 |
| 状态机渲染 | 前端不得自定义状态名 |

### 3.3 联调清单
- 接口可用性（路径、方法、鉴权）。
- 字段一致性（类型、可选项、默认值）。
- 错误路径（参数错、权限错、配额不足、状态非法）。
- 超时与重试（上传、任务查询、Webhook 流程回执）。

### 3.4 输出物
- 联调问题单（按优先级和 owner 分配）。
- 日清机制（当天问题当天归类与更新状态）。
- 联调周报（完成率、阻塞项、风险项）。

## 4. 模板/示例

### 4.1 联调问题单模板
| issueId | 接口 | 现象 | 预期 | 严重级 | Owner | SLA |
|---|---|---|---|---|---|---|
| INT-001 | `POST /v1/tasks` | 未校验幂等键 | 返回 400/422 明确错误 | P1 | 后端A | 24h |

### 4.2 联调日报模板
- 日期：2026-02-20
- 新增问题：3
- 已关闭：2
- 阻塞：1（shared 环境 Redis 不可用）
- 明日计划：完成任务中心状态流联调

## 5. 验收
- 接口兼容率 100%。
- 关键链路联调 case 全通过。
- shared 与 staging 不存在未解释差异。

## 6. 版本记录
| 版本 | 日期 | 说明 |
|---|---|---|
| v1.0 | 2026-02-19 | 首版前后端联调流程规范 |
