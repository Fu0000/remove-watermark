# 测试流程规范（v1.0）

## 1. 目标
- 建立端到端质量门禁，保障核心链路上线稳定。
- 让测试活动可映射 FR/NFR/MET。

## 2. 范围
- 覆盖单元、集成、契约、E2E、回归、冒烟测试。
- 适用环境：`dev/shared/staging/prod`。

## 3. 规则

### 3.1 测试分层
| 层级 | 目标 | 责任 |
|---|---|---|
| 单元测试 | 业务函数与状态机规则正确 | 开发 |
| 集成测试 | DB/Redis/队列/存储协作正确 | 开发+测试 |
| 契约测试 | 前后端接口字段与错误码一致 | 前后端 |
| E2E | 用户主流程可用 | 测试 |
| 回归测试 | 历史问题不回归 | 测试 |
| 冒烟测试 | 发布前快速健康检查 | 测试+运维 |

### 3.2 关键覆盖链路
- 图片任务主链路。
- 视频任务主链路。
- 任务失败/重试/取消。
- 订阅生效与配额扣减。
- Webhook 投递与重试。

### 3.3 质量门禁
- PR 阶段：`unit + lint + contract` 必过。
- Staging 阶段：`E2E + 回归 + 性能 smoke` 必过。
- 发布阶段：`NFR 达标 + P0/P1 缺陷清零`。

### 3.4 缺陷流程
| 严重级 | 定义 | 处理 SLA |
|---|---|---|
| P0 | 核心功能不可用/数据错误 | 4 小时内修复或回滚 |
| P1 | 核心功能受损但有绕行 | 24 小时内修复 |
| P2 | 非核心问题 | 本迭代修复 |
| P3 | 体验优化 | 排入后续迭代 |

## 4. 模板/示例

### 4.1 测试用例模板
| CaseID | 需求映射 | 前置条件 | 输入 | 预期结果 |
|---|---|---|---|---|
| TC-IMG-001 | FR-002, FR-005 | 用户已登录且有配额 | 上传 JPG 并创建任务 | 任务进入 QUEUED 且配额 HELD |

### 4.2 发布准入清单示例
- [ ] NFR-001、NFR-002、NFR-003 达标
- [ ] P0/P1 缺陷为 0
- [ ] 联调报告最新且无阻断项

## 5. 验收
- 测试报告可映射到 FR/NFR/MET 编号。
- 发布前有完整准入检查记录。
- 线上问题可回溯到对应测试覆盖缺口。

## 6. 版本记录
| 版本 | 日期 | 说明 |
|---|---|---|
| v1.0 | 2026-02-19 | 首版测试流程与质量门禁规范 |
