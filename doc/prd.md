# 去水印项目 PRD（v1.0）

## 1. 文档信息（版本、作者、评审人、状态、更新时间）

### 1.1 目标
- 提供一份可直接用于立项评审、研发排期与跨团队协作的产品需求文档（PRD）。
- 与技术基线文档 `/Users/codelei/Documents/ai-project/remove-watermark/doc/plan.md` 保持一致，避免需求与实现脱节。

### 1.2 范围
- 文档覆盖产品目标、用户场景、功能需求、商业化、接口约束、测试验收、里程碑与风险。
- 当前版本聚焦 v1.0，适用于微信小程序 + Web 首发，App 作为后续扩展。

### 1.3 规则
- 文档语言：中文。
- 需求编号规范：
  - 功能需求：`FR-xxx`
  - 非功能需求：`NFR-xxx`
  - 指标定义：`MET-xxx`
- 每条需求均绑定验收条件（输入、期望输出、阈值）。

### 1.4 指标
- 文档完整性：17 个章节齐全，章节信息不留空。
- 可执行性：每条 FR/NFR/MET 均可映射到研发任务与测试用例。

### 1.5 验收
- 文档状态：`Review Ready`。
- 评审通过标准：产品、研发、测试、算法、运营、合规六方无阻塞项。

### 1.6 文档元信息

| 字段 | 内容 |
|---|---|
| 文档名称 | 去水印项目 PRD |
| 文档版本 | v1.0 |
| 当前状态 | Review Ready |
| 作者 | 产品与技术联合输出 |
| 评审人 | 产品负责人、技术负责人、算法负责人、测试负责人、合规负责人 |
| 创建日期 | 2026-02-19 |
| 最近更新 | 2026-02-19 |
| 对应技术基线 | `/Users/codelei/Documents/ai-project/remove-watermark/doc/plan.md` |

## 2. 背景与问题陈述（用户痛点、机会窗口、为什么现在做）

### 2.1 目标
- 明确产品要解决的问题、用户价值与业务价值，统一项目立项背景。

### 2.2 范围
- 覆盖个人创作者、中小团队在素材二次处理中的去水印场景。
- 涉及图片与视频的高频需求；PDF/PPT 图片页作为后续版本扩展。

### 2.3 规则
- 问题定义以真实场景为核心，不以算法能力为唯一导向。
- 优先覆盖“高频 + 高痛点 + 可标准化”的任务。

### 2.4 指标
- 用户痛点强度：手工去水印平均耗时 > 10 分钟/素材。
- 场景覆盖：MVP 覆盖目标用户高频任务占比 >= 70%。

### 2.5 验收
- 背景章节明确回答三件事：
  - 为什么用户需要该产品。
  - 为什么当前时点必须启动。
  - 为什么本项目的范围是当前最优解。

### 2.6 问题陈述
- 现状问题：
  - 去水印流程分散在多个工具中，学习与操作成本高。
  - 简单工具对复杂背景修复失败率高，结果不稳定。
  - 视频去水印耗时高，且容易产生闪烁和拖影。
- 机会窗口：
  - 小程序 + Web 低门槛触达，利于快速验证留存与转化。
  - 多模型组合成熟，可在“速度/质量/成本”间实现分层优化。

## 3. 产品目标与非目标（含北极星指标与阶段性目标）

### 3.1 目标
- 构建 C 端效率工具，帮助用户快速完成素材去水印并可直接交付使用。

### 3.2 范围
- 首发终端：微信小程序 + Web。
- MVP 能力：图片去水印、视频去水印、任务中心、结果下载、基础配额。

### 3.3 规则
- 已锁定产品决策（不可在 v1.0 内改变）：
  - 产品定位：C 端效率工具。
  - 商业模式：免费额度 + 订阅制。
  - 合规边界：仅处理用户自有/有权素材，不支持外链抓取。
  - 算法策略：规则 + CV + 深度模型混合方案。

### 3.4 指标
- 北极星指标：
  - `MET-001` 7 日留存率。
- 阶段性目标：
  - 上线后 4 周内，`MET-002` 上传到任务创建转化率 >= 60%。
  - 上线后 4 周内，`MET-003` 任务成功率 >= 95%（剔除用户取消）。
  - 上线后 8 周内，`MET-005` 订阅转化率 >= 3%。

### 3.5 验收
- 产品目标与非目标清晰，无互相冲突。
- 目标可被数据系统观测，且责任归属明确。

### 3.6 非目标（v1.0 不做）
- 不做第三方平台链接解析与内容抓取。
- 不做可编辑 PPT 回写。
- 不做端侧离线推理。
- 不做企业私有化交付。

## 4. 用户画像与 JTBD（主/次人群、任务陈述）

### 4.1 目标
- 刻画核心用户群与关键任务，确保需求优先级对齐用户价值。

### 4.2 范围
- 主人群：个人创作者、电商运营、中小团队内容制作人员。
- 次人群：教育培训素材整理人员、企业品牌运营人员。

### 4.3 规则
- 画像必须与任务行为绑定（JTBD），避免抽象标签化描述。
- 画像驱动功能优先级：高频任务优先于低频复杂任务。

### 4.4 指标
- 主人群任务覆盖率：>= 80%。
- 高频任务（图片+短视频）成功完成率：>= 95%。

### 4.5 验收
- 每类画像均有可验证任务陈述（When/Want/So that）。

### 4.6 用户画像与 JTBD

| 画像 | 场景描述 | JTBD |
|---|---|---|
| 电商运营 | 快速处理商品图和推广短视频 | 当我批量准备上新素材时，我希望快速去除原有水印，以便在截止时间前完成发布。 |
| 自媒体创作者 | 二创内容质量要求高 | 当我处理复杂背景素材时，我希望修复痕迹尽可能少，以便内容看起来更自然。 |
| 教培从业者 | 课件资料页数多 | 当我整理大量页图资料时，我希望一次提交后自动处理，以便减少重复劳动。 |
| 小团队负责人 | 关注效率和成本 | 当团队多人协作处理素材时，我希望有配额和记录可见，以便控制成本和进度。 |

## 5. 用户场景与用户旅程（上传-处理-下载全链路）

### 5.1 目标
- 定义用户在产品中的完整路径，明确关键交互点和失败兜底策略。

### 5.2 范围
- 覆盖图片与视频的主流程与异常流程。
- 包含任务重试、取消、失败反馈和结果管理。

### 5.3 规则
- 每个流程节点必须有状态定义与异常处理规则。
- 关键状态必须可视化反馈（进度、预计耗时、失败原因）。

### 5.4 指标
- 流程完成率（上传到下载）：>= 70%。
- 首次结果时间（TTFR）：图片 <= 8 秒 P95。

### 5.5 验收
- 用户旅程图覆盖主流程和至少 5 类异常分支。

### 5.6 用户旅程（主流程）
1. 用户登录并进入上传页。
2. 选择图片/视频文件，进行格式与大小校验。
3. 客户端获取上传策略并直传对象存储。
4. 创建任务，系统进入排队/处理状态。
5. 自动检测后展示预览，用户可手动修复掩膜。
6. 处理完成后生成结果预览与下载链接。
7. 用户下载结果或继续二次调整。

### 5.7 异常旅程（示例）
- 上传失败：提示重试并保留已选择文件。
- 任务失败：展示错误码与失败原因，支持一键重试。
- 配额不足：提示升级订阅或等待下周期恢复。
- 网络中断：任务中心可恢复查询，不丢历史状态。

## 6. 范围定义（MVP、V1.1、V1.2）

### 6.1 目标
- 明确版本边界与优先级，确保发布节奏可控。

### 6.2 范围
- MVP（v1.0）：图片 + 视频全流程与订阅能力。
- V1.1：PDF/PPT 图片页去水印能力。
- V1.2：批量模板、企业能力（团队管理/权限）。

### 6.3 规则
- 版本范围冻结后，仅允许通过变更评审新增需求。
- 非 MVP 需求不占用 MVP 发布资源。

### 6.4 指标
- MVP 按计划发布，延期不超过 1 周。
- MVP 发布后 2 周内核心流程稳定性达标（NFR 满足）。

### 6.5 验收
- 范围矩阵可被研发与测试直接拆解为 backlog。

### 6.6 版本范围矩阵

| 功能项 | MVP(v1.0) | V1.1 | V1.2 |
|---|---|---|---|
| 图片去水印 | 是 | 是 | 是 |
| 视频去水印 | 是 | 是 | 是 |
| PDF 图片页去水印 | 否 | 是 | 是 |
| PPT 图片页去水印 | 否 | 是 | 是 |
| 基础配额与订阅 | 是 | 是 | 是 |
| 批量模板 | 否 | 否 | 是 |
| 团队管理与权限 | 否 | 否 | 是 |

## 7. 功能需求（按模块分 FR 编号）

### 7.1 目标
- 定义可开发、可测试、可验收的产品功能需求集合。

### 7.2 范围
- 覆盖身份、上传、检测、修复、任务、结果、订阅、通知、数据管理、风控、运营后台。

### 7.3 规则
- 每条 `FR` 必须具备：输入、处理规则、输出、阈值、异常处理。
- 功能依赖关系必须明确（前置/后置）。

### 7.4 指标
- 功能完整率：12 条 FR 全部具备验收项。
- 可测性：每条 FR 至少 2 条测试场景。

### 7.5 验收
- FR 清单通过需求评审并被映射到开发任务。

### 7.6 FR 需求清单与验收条件

| 编号 | 需求描述 | 输入 | 期望输出 | 阈值/规则 | 验收标准 |
|---|---|---|---|---|---|
| FR-001 | 登录与身份体系 | 微信授权码/Web 登录凭证 | 有效会话 Token、用户信息 | Token 续期、设备会话可管理 | 10 次连续登录成功率 100%，Token 过期可自动刷新 |
| FR-002 | 上传能力 | 图片/视频文件 | `assetId`、上传成功状态 | 格式/大小校验、分片上传 | 1GB 内文件支持断点续传，上传失败可恢复 |
| FR-003 | 自动检测 | `assetId`、任务类型 | 候选掩膜区域 | 自动检测优先，支持后续人工修正 | 常见角标水印自动命中率达到目标集阈值 |
| FR-004 | 手动修复 | 候选掩膜或空白画布 | 用户修正后的最终掩膜 | 画笔/橡皮/撤销重做可用 | 交互延迟 < 150ms，20 次连续编辑无崩溃 |
| FR-005 | 任务创建与编排 | 任务参数（标准/高质量） | 任务 ID、状态推进 | 支持排队、重试、取消 | 状态机流转正确率 100% |
| FR-006 | 任务中心 | 用户查询请求 | 任务列表、进度、失败原因 | 按时间倒序，支持筛选 | 新任务状态刷新延迟 <= 3 秒 |
| FR-007 | 结果交付 | 处理完成任务 | 下载链接、预览图 | 到期提醒，支持再次编辑 | 下载链接有效期可配置，失效前提示可见 |
| FR-008 | 配额与订阅 | 用户套餐状态、使用量 | 可用额度、升级入口 | 免费额度+订阅扣减 | 额度扣减与任务消费一致率 100% |
| FR-009 | 通知体系 | 任务状态变化、订阅状态变化 | 站内通知/订阅消息 | 仅关键节点触发通知 | 成功/失败/到期提醒均可到达且可追踪 |
| FR-010 | 数据管理 | 删除请求（素材/任务/账户） | 删除结果状态 | 异步擦除+审计留痕 | 删除任务可追踪，状态可查询 |
| FR-011 | 风控与审计 | 敏感操作、异常流量 | 风控动作、审计记录 | 限流、封禁、申诉入口 | 违规请求触发风控命中，审计日志完整 |
| FR-012 | 运营后台（最小集） | 管理员查询与操作 | 任务检索、异常重放、套餐管理 | RBAC 权限控制 | 非授权账号无法访问后台接口 |

## 8. 交互与体验要求（关键页面、状态、错误处理）

### 8.1 目标
- 保障核心流程简洁、可理解、可恢复，降低用户学习成本。

### 8.2 范围
- 页面：上传页、编辑页、任务中心、结果页、账户页。
- 状态：空态、加载态、处理中、成功态、失败态、无权限、配额不足。

### 8.3 规则
- 关键动作必须可逆（可撤销或二次确认）。
- 错误文案必须可行动（告诉用户下一步做什么）。

### 8.4 指标
- 首次上手完成率 >= 80%。
- 关键页面崩溃率 < 0.3%。
- 误操作率（取消后后悔/重复提交）持续下降。

### 8.5 验收
- 关键页面提供原型与状态图，并通过可用性评审。

### 8.6 页面级体验要求
- 上传页：
  - 支持拖拽/选择文件，明确格式与大小限制。
  - 上传中显示进度与预计剩余时间。
- 编辑页：
  - 支持前后对比滑块、画笔大小调节、撤销重做。
  - 自动检测结果可关闭/重试。
- 任务中心：
  - 显示任务状态、耗时、失败原因、重试入口。
  - 支持跨端同步查看。
- 结果页：
  - 支持预览、下载、再次编辑。
  - 链接过期前提示续期或重新生成。

## 9. 商业化与套餐体系（免费额度、订阅方案、配额消耗规则）

### 9.1 目标
- 构建清晰、可理解、可执行的变现体系，兼顾转化与用户体验。

### 9.2 范围
- 套餐定义、配额扣减、订阅生命周期、退款与降级策略。

### 9.3 规则
- 商业策略：免费额度 + 订阅制（已锁定）。
- 支付优先级：微信支付优先。
- 计费口径透明，消费记录可追溯。

### 9.4 指标
- `MET-005` 订阅转化率。
- 订阅后 7 日留存率。
- 退款率与争议率。

### 9.5 验收
- 套餐权益、扣减规则、异常处理规则均可前后端一致执行。

### 9.6 套餐建议（v1.0）

| 套餐 | 价格（示例） | 月配额 | 能力 |
|---|---|---|---|
| Free | 0 元 | 20 点 | 标准档、基础排队 |
| Pro 月付 | 39 元 | 300 点 | 标准+高质量、优先队列 |
| Pro 年付 | 299 元 | 3600 点 | 同 Pro 月付，折扣更高 |

### 9.7 配额消耗规则（示例）
- 图片标准档：1 点/张。
- 图片高质量档：2 点/张。
- 视频标准档：每 15 秒 6 点。
- 视频高质量档：每 15 秒 12 点。

### 9.8 订阅生命周期规则
- 购买成功：权益实时生效。
- 到期处理：降级 Free，保留历史记录。
- 退款回滚：按未使用额度比例回滚权益。

## 10. 数据与埋点方案（事件、指标口径、看板维度）

### 10.1 目标
- 建立可驱动产品增长与质量优化的数据闭环。

### 10.2 范围
- 指标定义、埋点事件、字段口径、看板维度、归因窗口。

### 10.3 规则
- 指标必须可复现，口径不可随意变更。
- 关键事件必须具备 `traceId` 与上下文字段。

### 10.4 指标
- `MET-001` 7 日留存率。
- `MET-002` 上传转任务创建转化率。
- `MET-003` 任务成功率。
- `MET-004` 首次结果时长（TTFR）。
- `MET-005` 订阅转化率。

### 10.5 验收
- 数据看板可在 T+1 完整输出核心指标。
- 各指标 SQL 口径与文档定义一致。

### 10.6 MET 指标定义

| 编号 | 指标 | 定义 | 目标值 |
|---|---|---|---|
| MET-001 | 7 日留存率 | D0 新增用户中，D7 仍有有效行为（上传或任务查询）的用户占比 | 上线后 8 周 >= 20% |
| MET-002 | 上传到创建转化率 | 完成上传用户中创建任务用户占比 | >= 60% |
| MET-003 | 任务成功率 | 成功任务数 / 总任务数（剔除用户取消） | >= 95% |
| MET-004 | TTFR | 用户从提交任务到首次可预览结果的耗时 | 图片 P95 < 8s |
| MET-005 | 订阅转化率 | 付费用户数 / 活跃用户数 | 上线后 8 周 >= 3% |

### 10.7 关键埋点事件
- `upload_started`
- `upload_succeeded`
- `task_created`
- `task_succeeded`
- `task_failed`
- `subscribe_started`
- `subscribe_paid`

### 10.8 埋点字段规范
- 必填：`userId`, `traceId`, `platform`, `taskType`, `qualityLevel`, `errorCode`, `eventTime`
- 建议：`fileSize`, `durationSec`, `networkType`, `deviceModel`, `appVersion`

## 11. 技术与接口约束（前后端规约、状态机、错误码）

### 11.1 目标
- 保证需求与技术实现一致，减少跨端、跨服务歧义。

### 11.2 范围
- API、状态机、错误码、数据类型、幂等与安全约束。

### 11.3 规则
- API 版本统一 `/v1`。
- 创建任务必须携带 `Idempotency-Key`。
- 统一响应结构：`{code,message,requestId,data}`。

### 11.4 指标
- 接口兼容性：灰度期间无 P0 级兼容问题。
- 错误码映射一致性：前后端一致率 100%。

### 11.5 验收
- 接口文档可直接导入测试平台；状态机流转可通过自动化校验。

### 11.6 关键接口清单
- 既有任务接口：
  - `GET /v1/system/capabilities`
  - `POST /v1/tasks`
  - `GET /v1/tasks/{taskId}`
  - `POST /v1/tasks/{taskId}/mask`
  - `GET /v1/tasks/{taskId}/result`
- 新增商业化接口：
  - `GET /v1/plans`
  - `POST /v1/subscriptions/checkout`
  - `GET /v1/subscriptions/me`
  - `GET /v1/usage/me`

### 11.7 核心类型
- `SystemCapabilities`：`models[]/renderers[]/videoPipelines[]/riskFlags[]/defaults`
- `CreateTaskRequest.taskPolicy`：`FAST|QUALITY|LOW_COST`（可选）
- `Plan`：`planId/name/price/monthlyQuota/features`
- `Entitlement`：`userId/planId/status/quotaLeft/expireAt`
- `UsageLedger`：`userId/taskId/consumeUnit/consumeAt/source`

### 11.8 状态机
- `UPLOADED -> QUEUED -> PREPROCESSING -> DETECTING -> INPAINTING -> PACKAGING -> SUCCEEDED|FAILED|CANCELED`

### 11.9 错误码规范（示例）

| 错误码 | 含义 | 处理建议 |
|---|---|---|
| 40001 | 参数非法 | 前端阻止提交并高亮字段 |
| 40002 | 文件格式不支持 | 显示支持格式 |
| 40003 | 文件大小超限 | 引导压缩或分片上传 |
| 40101 | 鉴权失败 | 触发重登 |
| 40901 | 重复任务请求 | 拉取已有任务状态 |
| 42901 | 频率受限 | 指数退避重试 |
| 50001 | 处理失败 | 给出重试入口 |
| 50301 | 服务繁忙 | 稍后重试并保留参数 |

## 12. 安全与合规要求（版权声明、审计、删除策略）

### 12.1 目标
- 确保平台在版权、数据安全、审计合规方面满足上线条件。

### 12.2 范围
- 用户授权、数据保护、审计日志、删除机制、违规处理。

### 12.3 规则
- 上传前必须勾选授权声明。
- 禁止第三方外链抓取能力。
- 用户可申请删除素材与账户数据。

### 12.4 指标
- 授权勾选覆盖率：100%。
- 删除请求 SLA：提交后 24 小时内完成。
- 审计日志完整率：100%。

### 12.5 验收
- 合规评审无阻塞问题。
- 删除、审计、风控链路可演示并留存证据。

### 12.6 安全与合规清单
- 传输安全：全站 HTTPS。
- 存储安全：对象存储签名 URL 短时效。
- 审计要求：关键操作保留 `userId`、`traceId`、IP、UA、时间。
- 申诉机制：违规封禁后提供申诉入口。

### 12.7 渲染链路失败回退策略（V1.1）
- 统一链路：`PPT/PPTX -> LibreOffice headless -> PDF -> 页图渲染 -> 图像修复 -> 输出`。
- 渲染器选型：服务端默认 `PDFium`；不可用时按 `Poppler -> PyMuPDF` 顺序回退（通过 `GET /v1/system/capabilities` 暴露可用集合与默认路由）。
- 选型规则：优先保真与稳定，其次吞吐；同一任务内渲染器与版本固定，避免页间差异。
- 失败回退：转换失败、字体缺失、版式异常时，返回可执行提示并建议上传 PDF 源文件。
- 错误规范：渲染失败必须返回标准错误码与 `traceId`，支持用户重试与客服排障。
- 观测要求：渲染环节单独打点（成功率、耗时、失败原因TopN）。

## 13. 非功能需求（性能、稳定性、可观测性、扩展性）

### 13.1 目标
- 用量化阈值约束系统质量，保障线上稳定交付。

### 13.2 范围
- 性能、可用性、成功率、安全、可观测性、扩展能力。

### 13.3 规则
- 所有 NFR 必须可测量，可在预发与线上验证。
- 未满足 NFR 的版本不得上线全量。

### 13.4 指标
- `NFR-001` 图片 P95 < 8s；15 秒视频 P95 < 120s（standard）。
- `NFR-002` API 月可用性 >= 99.9%。
- `NFR-003` 任务成功率 >= 95%（剔除取消）。
- `NFR-004` HTTPS + 全链路鉴权 + 签名 URL。
- `NFR-005` 上传授权勾选必达 + 审计可追溯。
- `NFR-006` traceId 贯穿，错误码可聚合。
- `NFR-007` Worker 水平扩容 + 队列优先级调度。
- 容量估算口径：统一使用 `GPU秒/任务`，并按 `GPU秒/任务 * 每分钟任务数 / 60` 计算目标 GPU 并发容量。

### 13.5 验收
- NFR 项在压测、演练、灰度阶段均达到阈值。

### 13.6 NFR 验收映射

| NFR 编号 | 测试方式 | 验收阈值 |
|---|---|---|
| NFR-001 | 压测+真实样本回放 | 达到时延阈值 |
| NFR-002 | 监控统计 | 月可用性 >= 99.9% |
| NFR-003 | 任务统计 | 成功率 >= 95% |
| NFR-004 | 安全扫描+接口检查 | 无高危漏洞 |
| NFR-005 | 业务流程演练 | 授权/审计链路完整 |
| NFR-006 | 观测平台校验 | trace 可追踪 |
| NFR-007 | 扩容演练 | 扩容后指标稳定 |

## 14. 里程碑与发布计划（12 周节奏）

### 14.1 目标
- 用可执行节奏管理跨团队交付，确保版本可控发布。

### 14.2 范围
- 包含需求冻结、开发、联调、灰度、正式发布五阶段。

### 14.3 规则
- 每个里程碑必须有“交付物 + 验收标准 + 负责人”。
- 里程碑变更需走评审流程。

### 14.4 指标
- 里程碑按期达成率 >= 90%。
- 关键延期不超过 1 周。

### 14.5 验收
- 每阶段输出物齐全并通过阶段评审。

### 14.6 12 周计划

| 阶段 | 周期 | 主要交付 |
|---|---|---|
| M0 | 第 1-2 周 | PRD 冻结、原型评审、指标定义冻结 |
| M1 | 第 3-5 周 | 图片链路上线（小程序+Web 灰度） |
| M2 | 第 6-8 周 | 视频链路上线、订阅与配额上线 |
| M3 | 第 9-10 周 | 稳定性优化、A/B 实验、漏斗优化 |
| M4 | 第 11-12 周 | 正式发布、运营看板、V1.1 需求冻结 |

## 15. 风险、依赖与应对

### 15.1 目标
- 提前识别项目风险与外部依赖，降低上线不确定性。

### 15.2 范围
- 算法效果、性能成本、第三方能力、合规风险、项目管理风险。

### 15.3 规则
- 风险必须有责任人、预警信号、缓解动作和兜底方案。

### 15.4 指标
- 高风险项关闭率 >= 90%（上线前）。
- P0 风险上线前清零。

### 15.5 验收
- 风险台账完整，且所有高风险有明确执行中的缓解动作。

### 15.6 风险与依赖清单

| 类型 | 风险/依赖 | 影响 | 应对策略 |
|---|---|---|---|
| 算法 | 复杂纹理修复失败 | 影响用户口碑 | 混合路由+人工蒙版兜底 |
| 成本 | 高质量视频 GPU 成本过高 | 影响毛利 | 标准/高质量分档与优先队列 |
| 工程 | 高并发队列积压 | 影响时延 | 队列扩容与限流 |
| 第三方 | 支付能力异常 | 影响转化 | 支付重试与订单补偿 |
| 合规 | 权属争议投诉 | 影响平台风险 | 强制授权声明+审计留痕+申诉流程 |

### 15.7 技术与许可风险台账（记录不阻断）

| 风险ID | 风险项 | 级别 | 触发条件 | 处置策略 |
|---|---|---|---|---|
| R-LIC-001 | 视频高质量模型许可限制（非商用/需授权） | 高 | 外部发布前未完成核验 | 记录台账并给出替代模型；不阻断研发迭代 |
| R-LIC-002 | 文档渲染组件许可与分发策略不一致 | 中 | 端侧打包或二次分发时 | 锁定版本与许可证文本，补充法律审阅记录 |
| R-TECH-001 | 逐帧视频修复时域闪烁 | 中 | 使用帧级方案处理复杂运动 | 默认FAST路由+QUALITY可选，并提示质量预期 |
| R-TECH-002 | PPT 转换保真不足 | 中 | 字体/模板不兼容 | 回退上传 PDF 路径并保留错误诊断信息 |
| R-COST-001 | 高质量队列成本失控 | 中 | 峰值高质量任务拥塞 | 配额限流、队列分级、成本告警阈值 |

## 16. 验收与上线准入标准

### 16.1 目标
- 给出统一上线门槛，确保质量、合规、稳定性全部达标。

### 16.2 范围
- 功能验收、回归验收、商业验收、合规验收、线上保障。

### 16.3 规则
- 未满足准入项不得全量发布。
- P0/P1 缺陷清零后才能上线。

### 16.4 指标
- NFR 全部达标。
- 关键 FR 测试通过率 100%。
- 监控告警覆盖率 100%。

### 16.5 验收
- 发布评审会议通过，形成上线纪要。

### 16.6 测试场景清单
- 场景验收：单图、短视频、复杂背景、弱网、任务取消、任务重试。
- 商业验收：免费额度耗尽、订阅生效、续费、到期降级、退款回滚。
- 合规验收：授权勾选、删除请求、审计追踪、无外链入口。
- 回归验收：接口兼容、状态机一致性、错误码映射一致。

### 16.7 上线准入 Checklist
- `NFR-001` 至 `NFR-007` 全部通过。
- P0/P1 缺陷清零。
- 监控告警（接口、队列、任务成功率、支付）全部生效。
- 回滚预案已演练。

## 17. 附录（术语、参考资料、变更记录）

### 17.1 目标
- 提供统一术语、外部依据与版本演进记录，便于长期维护。

### 17.2 范围
- 术语表、参考资料、变更记录。

### 17.3 规则
- 术语定义以本文为准。
- 参考资料优先官方文档或原始论文/项目。

### 17.4 指标
- 术语歧义项为 0。
- 变更记录与版本一致。

### 17.5 验收
- 新成员可仅阅读附录理解关键术语与资料来源。

### 17.6 术语表（节选）

| 术语 | 含义 |
|---|---|
| TTFR | 首次可预览结果时间 |
| P95 | 95 分位响应/处理时延 |
| Idempotency-Key | 幂等键，避免重复创建任务 |
| Entitlement | 用户订阅权益实体 |

### 17.7 参考资料
- [OpenCV Inpainting](https://docs.opencv.org/4.x/df/d3d/tutorial_py_inpainting.html)
- [FFmpeg Filters](https://ffmpeg.org/ffmpeg-filters.html)
- [LaMa](https://github.com/advimman/lama)
- [SAM 2](https://github.com/facebookresearch/sam2)
- [ProPainter](https://github.com/sczhou/ProPainter)
- [E2FGVI](https://github.com/MCG-NKU/E2FGVI)
- [PaddleOCR](https://www.paddleocr.ai/main/en/index.html)
- [PyMuPDF](https://pymupdf.readthedocs.io/en/latest/)
- [LibreOffice CLI](https://help.libreoffice.org/latest/en-US/text/shared/guide/start_parameters.html)
- [Triton Inference Server](https://docs.nvidia.com/deeplearning/triton-inference-server/user-guide/docs/index.html)
- [ONNX Runtime Performance](https://onnxruntime.ai/docs/performance/)
- [Celery](https://docs.celeryq.dev/en/stable/getting-started/introduction.html)
- [uni-app](https://uniapp.dcloud.net.cn/)

### 17.8 变更记录

| 版本 | 日期 | 变更说明 |
|---|---|---|
| v1.1 | 2026-02-19 | 新增渲染器选型与回退规则，补充 GPU 秒容量估算口径，固化风险台账追踪策略 |
| v1.0 | 2026-02-19 | 首版 PRD，覆盖 17 章完整结构、FR/NFR/MET 及验收标准 |
